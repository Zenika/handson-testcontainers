<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web Browser Container | Dockerisez vos tests d’intégration</title>
    <meta name="description" content="Mise en place de testcontainers pour l&#39;application Spring Petclinic">
    
    
    <link rel="preload" href="/handson-testcontainers/assets/css/0.styles.91419a4e.css" as="style"><link rel="preload" href="/handson-testcontainers/assets/js/app.c2e303ce.js" as="script"><link rel="preload" href="/handson-testcontainers/assets/js/2.cbe199e7.js" as="script"><link rel="preload" href="/handson-testcontainers/assets/js/8.4a1a83bb.js" as="script"><link rel="prefetch" href="/handson-testcontainers/assets/js/10.cbb91124.js"><link rel="prefetch" href="/handson-testcontainers/assets/js/11.96fd053a.js"><link rel="prefetch" href="/handson-testcontainers/assets/js/3.9e8a07c9.js"><link rel="prefetch" href="/handson-testcontainers/assets/js/4.2a3280e3.js"><link rel="prefetch" href="/handson-testcontainers/assets/js/5.0ebf20bb.js"><link rel="prefetch" href="/handson-testcontainers/assets/js/6.c8268d99.js"><link rel="prefetch" href="/handson-testcontainers/assets/js/7.a35d126c.js"><link rel="prefetch" href="/handson-testcontainers/assets/js/9.84e18139.js">
    <link rel="stylesheet" href="/handson-testcontainers/assets/css/0.styles.91419a4e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/handson-testcontainers/" class="home-link router-link-active"><!----> <span class="site-name">Dockerisez vos tests d’intégration</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/vgallet/handson-testcontainers" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/vgallet/handson-testcontainers" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/handson-testcontainers/1_GETTING_STARTED.html" class="sidebar-link">Getting Started</a></li><li><a href="/handson-testcontainers/2_ARCHITECTURE.html" class="sidebar-link">Architecture</a></li><li><a href="/handson-testcontainers/3_MYSQL_CONTAINER.html" class="sidebar-link">MySQL Container</a></li><li><a href="/handson-testcontainers/4_WEB_BROWSER_CONTAINER.html" class="active sidebar-link">Web Browser Container</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/handson-testcontainers/4_WEB_BROWSER_CONTAINER.html#les-tests-d-acception-e2e" class="sidebar-link">Les Tests d'acception E2E</a></li><li class="sidebar-sub-header"><a href="/handson-testcontainers/4_WEB_BROWSER_CONTAINER.html#tests-e2e-explication-et-lancement-initial" class="sidebar-link">Tests E2E explication et lancement initial</a></li><li class="sidebar-sub-header"><a href="/handson-testcontainers/4_WEB_BROWSER_CONTAINER.html#lancement-de-tests-selenium-avec-un-navigateur-conteneurise" class="sidebar-link">Lancement de tests selenium avec un navigateur conteneurisé</a></li><li class="sidebar-sub-header"><a href="/handson-testcontainers/4_WEB_BROWSER_CONTAINER.html#screenshots" class="sidebar-link">Screenshots</a></li><li class="sidebar-sub-header"><a href="/handson-testcontainers/4_WEB_BROWSER_CONTAINER.html#differents-navigateurs" class="sidebar-link">Différents navigateurs</a></li></ul></li><li><a href="/handson-testcontainers/5_PAGE_PATTERN.html" class="sidebar-link">Page Pattern (Partie Bonus)</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="web-browser-container"><a href="#web-browser-container" aria-hidden="true" class="header-anchor">#</a> Web Browser Container</h1> <h2 id="les-tests-d-acception-e2e"><a href="#les-tests-d-acception-e2e" aria-hidden="true" class="header-anchor">#</a> Les Tests d'acception E2E</h2> <p>Les tests d'acceptation sont une phase d'un processus de développement logiciel. Ils permettent de déterminer si le produit a satisfait les spécifications globales des exigences et s'il est «accepté» comme prêt à être livré.</p> <p>Il s'agit généralement de la dernière phase de test avant la mise en production du produit.</p> <p>Ils existent plusieurs solutions pour mettre en place des tests d'IHM, <a href="https://www.seleniumhq.org/" target="_blank" rel="noopener noreferrer">SeleniumHQ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer">Cypress<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="http://phantomjs.org/" target="_blank" rel="noopener noreferrer">PhantomJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, etc ...</p> <p>Il n'est jamais simple de maintenir une base de tests fonctionnels, de tests E2E. Ces derniers sont par nature très volatiles puisqu'ils couvrent de grands pans de l'application.</p> <p>De plus, cela nécessite beaucoup de configurations, ce qui augmente les chances d'échecs lorsque les tests sont exécutés sur différentes machines ou dans un environnement CI (intégration continue).</p> <p>L'installation et la maintenance de différents navigateurs et WebDrivers pour les tests locaux et les tests de CI prennent du temps.</p> <p>Et même une fois terminé, ils peuvent toujours échouer à cause de problèmes simples. Par exemple si la résolution d'écran sur les machines locales de développement et dans une CI sont différentes.</p> <h2 id="tests-e2e-explication-et-lancement-initial"><a href="#tests-e2e-explication-et-lancement-initial" aria-hidden="true" class="header-anchor">#</a> Tests E2E explication et lancement initial</h2> <p>Dans le code fournis, la classe <code>OwnersPageIHMTest.java</code> est un test se basant sur l'outil Selenium et plus précisement sur le driver <a href="https://github.com/SeleniumHQ/htmlunit-driver" target="_blank" rel="noopener noreferrer">HtmlUnitDriver<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
qui est une abstraction pour manipuler le navigateur headless <a href="http://htmlunit.sourceforge.net/" target="_blank" rel="noopener noreferrer">HtmlUnit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        webDriver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HtmlUnitDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Les drivers selenium permettent d'avoir une abstraction entre le navigateur internet que l'on manipule et les actions que l'on réalise.</p> <p>On trouve notamment les classes <code>FirefoxDriver</code>, <code>ChromeDriver</code>, <code>EdgeDriver</code>, <code>InternetExplorerDriver</code>, etc ...<br>
Ces classes sont des implémentations différentes de la classe <code>WebDriver</code>. Ces implémentations sont propres au navigateur avec lequel on souhaite communiquer.</p> <p>Grâce à Testcontainers, il est possible d'encapsuler le navigateur dans un conteneur et de maintenir facilement la version utilisée.</p> <div class="tip custom-block"><p>Avant de démarrer la migration vers Testcontainers, assurez-vous que le test <code>OwnersPageIHMTest.java</code> fonctionne.</p></div> <h2 id="lancement-de-tests-selenium-avec-un-navigateur-conteneurise"><a href="#lancement-de-tests-selenium-avec-un-navigateur-conteneurise" aria-hidden="true" class="header-anchor">#</a> Lancement de tests selenium avec un navigateur conteneurisé</h2> <p>Pour la suite, il est nécéssaire d'importer la dépendance suivante :</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.testcontainers<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>selenium<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.11.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Une fois le module importé, vous pouvez créer votre container docker exposant un navigateur (Firefox par defaut) grâce à la classe fournie par Testcontainers : <code>BrowserWebDriverContainer</code>.</p> <p>Le container précédemment crée vous permet de remplacer le driver <code>HtmlUnitDriver</code> par un driver Firefox.</p> <p>Sans modification particulière de la méthode <code>should_find_jeff_black_owner()</code> celle-ci devrait échouer, trouver pourquoi et remédier à ce problème.</p> <div class="tip custom-block"><p>Notez que le serveur web lancé par le test écoute sur l'interface réseau <code>0.0.0.0/8080</code>, alors que le navigateur firefox de testcontainers se trouve dans un conteneur.</p></div> <details><summary>Afficher la réponse</summary> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">BrowserWebDriverContainer</span> genericContainer<span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token punctuation">{</span>
    genericContainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWebDriverContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withCapabilities</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FirefoxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    genericContainer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
    
<span class="token keyword">private</span> <span class="token class-name">WebDriver</span> webDriver<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Before</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    webDriver <span class="token operator">=</span> genericContainer<span class="token punctuation">.</span><span class="token function">getWebDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">should_find_jeff_black_owner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token comment">// L'adresse IP peut être obtenue sous linux avec à partir de l'interface réseau docker0</span>
    <span class="token comment">// Sous Mac et Windows, à partir de la version 18.03 de Docker, il est possible d'utiliser `host.docker.internal` </span>
    webDriver<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://&quot;</span> <span class="token operator">+</span> dockerIp <span class="token operator">+</span> <span class="token string">&quot;:8080/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    webDriver<span class="token punctuation">.</span><span class="token function">findElement</span><span class="token punctuation">(</span><span class="token class-name">By</span><span class="token punctuation">.</span><span class="token function">cssSelector</span><span class="token punctuation">(</span><span class="token string">&quot;[title*='find owners']&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <h2 id="screenshots"><a href="#screenshots" aria-hidden="true" class="header-anchor">#</a> Screenshots</h2> <p>Dans cette partie vous allez devoir réaliser une capture d'écran du navigateur lancé dans le conteneur et persister l'image sur votre disque.<br>
En reprenant le test fournis (<code>OwnersPageIHMTest</code>), capturer le resultat de la recherche du propriétaire &quot;Jeff Black&quot;.</p> <div class="tip custom-block"><p>Si vous souhaitez modifier la résolution de la capture d'écran, se conférer aux variables d'environnement disponible pour l'image docker <code>selenium/standalone-firefox-debug</code>.</p></div> <details><summary>Afficher la réponse</summary> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// into AbstractIntegrationTest.java</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> envs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
envs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;SCREEN_WIDTH&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1366&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
envs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;SCREEN_HEIGHT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;768&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
envs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;SCREEN_DEPTH&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;24&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

genericContainer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BrowserWebDriverContainer</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWebDriverContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withCapabilities</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FirefoxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withEnv</span><span class="token punctuation">(</span>envs<span class="token punctuation">)</span><span class="token punctuation">;</span>
genericContainer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// into OwnersPageIHMTest.java</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">take_screenshot_jeff_black_owner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    webDriver<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://&quot;</span> <span class="token operator">+</span> dockerIpv4 <span class="token operator">+</span> <span class="token string">&quot;:8080/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    webDriver<span class="token punctuation">.</span><span class="token function">findElement</span><span class="token punctuation">(</span><span class="token class-name">By</span><span class="token punctuation">.</span><span class="token function">cssSelector</span><span class="token punctuation">(</span><span class="token string">&quot;[title*='find owners']&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">WebElement</span> lastname <span class="token operator">=</span> webDriver<span class="token punctuation">.</span><span class="token function">findElement</span><span class="token punctuation">(</span><span class="token class-name">By</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;lastName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lastname<span class="token punctuation">.</span><span class="token function">sendKeys</span><span class="token punctuation">(</span><span class="token string">&quot;black&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lastname<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// On attends que la page soit correctement chargée</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">File</span> outputFile <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">RemoteWebDriver</span><span class="token punctuation">)</span>webDriver<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getScreenshotAs</span><span class="token punctuation">(</span><span class="token class-name">OutputType</span><span class="token punctuation">.</span>FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> copied <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;./screenshot.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>outputFile<span class="token punctuation">.</span><span class="token function">toPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> copied<span class="token punctuation">.</span><span class="token function">toPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardCopyOption</span><span class="token punctuation">.</span>REPLACE_EXISTING<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <h2 id="differents-navigateurs"><a href="#differents-navigateurs" aria-hidden="true" class="header-anchor">#</a> Différents navigateurs</h2> <p>Nos tests fonctionnent maintenant avec un navigateur Firefox mais de quelle version s'agit-il ?</p> <p>En utilisant la classe <code>DesiredCapabilities</code> fournit par Selenium, spécifiez la version de Firefox avec une version <code>66</code> par exemple.</p> <details><summary>Afficher la réponse</summary> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token class-name">DesiredCapabilities</span> firefox <span class="token operator">=</span> <span class="token class-name">DesiredCapabilities</span><span class="token punctuation">.</span><span class="token function">firefox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    firefox<span class="token punctuation">.</span><span class="token function">setPlatform</span><span class="token punctuation">(</span><span class="token class-name">Platform</span><span class="token punctuation">.</span>LINUX<span class="token punctuation">)</span><span class="token punctuation">;</span>
    firefox<span class="token punctuation">.</span><span class="token function">setVersion</span><span class="token punctuation">(</span><span class="token string">&quot;66&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    genericContainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWebDriverContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withCapabilities</span><span class="token punctuation">(</span>firefox<span class="token punctuation">)</span><span class="token punctuation">;</span>
    genericContainer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <p>Lancez le test et contrôlez alors la version de Firefox utilisé, que constatez-vous ?</p> <div class="tip custom-block"><p>Vous pouvez connaître la version de Firefox en vous connectant directement au conteneur.</p> <details><summary>Affichez la réponse</summary> <div class="language-sh extra-class"><pre class="language-sh"><code>docker <span class="token builtin class-name">exec</span> -it <span class="token operator">&lt;</span>containerId<span class="token operator">&gt;</span> firefox -v
</code></pre></div></details> <br></div> <p>En réalité, le module Selenium fournit par Testcontainers se base sur le projet <a href="https://github.com/SeleniumHQ/docker-selenium" target="_blank" rel="noopener noreferrer">docker-selenium<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Ce dernier ne propose à l'heure actuelle que les navigateurs internet Firefox et Chrome.</p> <p>Ainsi, il est seulement possible pour l'instant de n'exécuter ses tests IHM avec Chrome 74 ou Firefox 67.</p> <details><summary>Afficher la réponse</summary> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token class-name">DesiredCapabilities</span> chrome <span class="token operator">=</span> <span class="token class-name">DesiredCapabilities</span><span class="token punctuation">.</span><span class="token function">chrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    genericContainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWebDriverContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withCapabilities</span><span class="token punctuation">(</span>chrome<span class="token punctuation">)</span><span class="token punctuation">;</span>
    genericContainer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <p>En réalité, pour pouvoir proposer ces deux navigateurs le conteneur <code>BrowserWebDriverContainer</code> met en place le mécanisme de Selenium Grid. Grâce à ce mécanisme, on peut s'attendre à ce que la liste des navigateurs et de leurs versions s'étoffent dans le futur.</p> <h3 id="selenium-grid"><a href="#selenium-grid" aria-hidden="true" class="header-anchor">#</a> Selenium Grid</h3> <p>Selenium Grid est un outil qui permet d’exécuter les tests sur différentes machines avec différents navigateurs. Il fait partie de la suite Selenium, spécialisé dans l'exécution de plusieurs tests sur différents navigateurs, systèmes d'exploitation et machines.</p> <p>Selenium Grid comprend deux éléments principaux: <strong>Hub</strong> et <strong>Nodes</strong>.</p> <p><img src="selenium_grid.png" alt="Selenium Grid"></p> <h4 id="hub"><a href="#hub" aria-hidden="true" class="header-anchor">#</a> Hub</h4> <p>Le Hub est le point central dans lequel nous pouvons charger nos tests. Il agit également en tant que serveur car il contrôle le réseau de machines de test.</p> <p>On ne compte qu'un seul Hub, maître du réseau, dans une Selenium Grid.</p> <p>Lorsqu'un test se lance avec des <code>DesiredCapabilities</code>, le Hub recherche le noeud qui correspond à la configuration donnée.</p> <p>Par exemple, vous pouvez indiquer que vous souhaitez exécuter le test sous Windows 10 et sur le navigateur Chrome avec version XXX. Le Hub tentera de trouver une machine dans son réseau qui correspond aux critères et exécutera le test sur cette dernière.</p> <p>S'il n'y a pas de correspondance, le Hub renverra une erreur.</p> <h4 id="node"><a href="#node" aria-hidden="true" class="header-anchor">#</a> Node</h4> <p>Un Node est simplement une machine qui s'est enregistrée auprès du Hub pour lui spécifier ses capacités. Par exemple, il s'agit d'une machine sous Linux, disposant d'un navigateur Firefox XXX et Chrome XXX.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/vgallet/handson-testcontainers/edit/master/tps/4_WEB_BROWSER_CONTAINER.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/handson-testcontainers/3_MYSQL_CONTAINER.html" class="prev">MySQL Container</a></span> <span class="next"><a href="/handson-testcontainers/5_PAGE_PATTERN.html">Page Pattern (Partie Bonus)</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/handson-testcontainers/assets/js/app.c2e303ce.js" defer></script><script src="/handson-testcontainers/assets/js/2.cbe199e7.js" defer></script><script src="/handson-testcontainers/assets/js/8.4a1a83bb.js" defer></script>
  </body>
</html>
